---
title: "WiDS Datathon 2022 - Building Energy Usage"
author: "Haley Egan"
date: "2/21/2022"
output: html_document
---
## Data Overview
* 100k observations collected over 7 years
* Building characteristics, weather data, energy usage
* Site Energy Usage Intensity (Sute EUI)
* Each row = single building observed in a given year
* Goal: predict the Site EUI for each row, given the characteristics of the building and the weather data for the location of the building
* Submit a solution file containing the predicted Site EUI values for each row in the test dataset.
(1) the training dataset where the observed values of the Site EUI for each row is provided and 
(2) the test dataset where we withhold the observed values of the Site EUI for each row.

```{r}
#load graphing libraries
library(GGally)
library(ggplot2)
library(tidyverse)
library(MASS)
library(class)
library(dplyr)
library(leaps)
```

```{r}
#read in data from csv file 
energy_test <- read.csv(file='test.csv')
energy_train <- read.csv(file='train.csv')
```

```{r}
#view datasets
#view(energy_test)
#view(energy_train)
head(energy_test)
head(energy_train)
```
```{r}
#attach(energy_train)
#attach(energy_test)
```


```{r}
dim(energy_test)
dim(energy_train)
```
```{r}
colnames(energy_train)
```
```{r}
#linear regression model for all variables against site_eui
lm.fit <- lm(site_eui~Year_Factor+floor_area+year_built+energy_star_rating+direction_max_wind_speed+direction_peak_wind_speed+avg_temp+cooling_degree_days+heating_degree_days+january_avg_temp+february_avg_temp+march_avg_temp+april_avg_temp+may_avg_temp+june_avg_temp+july_avg_temp+august_avg_temp+september_avg_temp+october_avg_temp+november_avg_temp+december_avg_temp, data=energy_train)
summary(lm.fit)
```
```{r}
#logistic regression model
glm.fit <- glm(site_eui~facility_type+building_class+State_Factor, data=energy_train)
summary(glm.fit)
```

```{r}
#reduced data frame
reduced_train <- subset(energy_train, select = c(site_eui, Year_Factor, floor_area, year_built, energy_star_rating, heating_degree_days, avg_temp, march_avg_temp, june_avg_temp, august_avg_temp, november_avg_temp, december_avg_temp))
head(reduced_train)
```

```{r}
#statistical summary of data
summary(reduced_train)
```

```{r}
pairs(reduced_train, lower.panel=NULL, main="Scatterplot Matrix of Quantitative Variables")
```
```{r}
#drop null and values
reduced_train <- na.omit(reduced_train)
```

# Model Diagnostics for quantitative variables
```{r}
#overal model diagnostics, one level
allregs <- regsubsets(site_eui~., data=reduced_train, nbest=1)
summary(allregs)
```

```{r}
#overal model diagnostics, two level
allregs <- regsubsets(site_eui~., data=reduced_train, nbest=2)
summary(allregs)
```

```{r}
#find coefs and predictors of model with best adj r2, cp, bic
coef(allregs, which.max(summary(allregs)$adjr2))
coef(allregs, which.min(summary(allregs)$cp))
coef(allregs, which.min(summary(allregs)$bic))
```
There is 1 model candidate with the reduced dataset, with: Year_Factor, floor_area, year_built, energy_star_rating, heating_degree_days, avg_temp, march_avg_temp, and november_avg_temp.


```{r}
#intercept only model
regnull <- lm(site_eui~1, data=reduced_train)

#model with all predictors
regfull <- lm(site_eui~., data=reduced_train)
```

```{r}
#forward selection
step(regnull, scope=list(lower=regnull, upper=regfull), direction='forward')
```
The resulting model recommendation of Forward Selection is all 11 of the predictors. 

```{r}
#backward elimination
step(regfull, scope=list(lower=regnull, upper=regfull), direction='backward')
```


```{r}
#stepwise regression
step(regfull, scope=list(lower=regnull, upper=regfull), direction='both')
```

The model recommendation for all tests is for the full model, with all 11 predictors. 














